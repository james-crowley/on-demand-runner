description: >
  Configure On Demand Runners
parameters:
  circle-token:
    default: CIRCLE_TOKEN
    description: |
      A valid Circle token for interacting with the CircleCI API. Please see
      https://circleci.com/docs/2.0/managing-api-tokens/ for more details.
    type: env_var_name
  circleci-namespace:
    default: CIRCLECI_NAMESPACE
    description: |
      A CircleCI generated namespace for your organization. Please see
      https://circleci.com/docs/2.0/orb-concepts/#namespaces for more details.
    type: env_var_name
steps:  
  - run: Configure On Demand Runners
    working_directory: ~/project/on-demand-runners/auto-runner/
    command: |
        ansible-playbook -i aws_ec2.yml install-runner.yml -u ansible -e "NAMESPACE=$CIRCLECI_NAMESPACE CIRCLE_TOKEN=$CIRCLE_TOKEN RESOURCE_CLASS_CREATION=true RUNNER_TOKEN_CREATION=true target_hosts=all"